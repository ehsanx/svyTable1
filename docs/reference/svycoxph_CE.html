<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Test Constant Effect (PH) Assumption for Survey Cox Models — svycoxph_CE • svyTable1</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Test Constant Effect (PH) Assumption for Survey Cox Models — svycoxph_CE"><meta name="description" content="This function provides a valid alternative to cox.zph() for complex survey
designs. It checks the Constant Effect (Proportional Hazards) assumption by
splitting the follow-up time into intervals (based on event quantiles), fitting
separate models for each interval, and plotting the estimated coefficients over time."><meta property="og:description" content="This function provides a valid alternative to cox.zph() for complex survey
designs. It checks the Constant Effect (Proportional Hazards) assumption by
splitting the follow-up time into intervals (based on event quantiles), fitting
separate models for each interval, and plotting the estimated coefficients over time."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">svyTable1</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.14.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v1-svyTable1-basics.html">Creating Descriptive Table 1 Summaries with svyTable1</a></li>
    <li><a class="dropdown-item" href="../articles/v2-model-diagnostics.html">Diagnosing Survey Regression Models with svyTable1</a></li>
    <li><a class="dropdown-item" href="../articles/v3-interaction-analysis.html">Analyzing Interaction Effects with svyTable1</a></li>
    <li><a class="dropdown-item" href="../articles/v4-survival-analysis.html">Survival Analysis with svyTable1</a></li>
    <li><a class="dropdown-item" href="../articles/v5-multiple-imputation.html">Formatting Multiple Imputation Results</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ehsanx/svyTable1/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Test Constant Effect (PH) Assumption for Survey Cox Models</h1>
      <small class="dont-index">Source: <a href="https://github.com/ehsanx/svyTable1/blob/HEAD/R/svycoxph_CE.R" class="external-link"><code>R/svycoxph_CE.R</code></a></small>
      <div class="d-none name"><code>svycoxph_CE.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function provides a valid alternative to <code><a href="https://rdrr.io/pkg/survival/man/cox.zph.html" class="external-link">cox.zph()</a></code> for complex survey
designs. It checks the Constant Effect (Proportional Hazards) assumption by
splitting the follow-up time into intervals (based on event quantiles), fitting
separate models for each interval, and plotting the estimated coefficients over time.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">svycoxph_CE</span><span class="op">(</span></span>
<span>  <span class="va">formula_rhs</span>,</span>
<span>  <span class="va">design</span>,</span>
<span>  <span class="va">var_to_test</span>,</span>
<span>  time_var <span class="op">=</span> <span class="st">"stime"</span>,</span>
<span>  status_var <span class="op">=</span> <span class="st">"status"</span>,</span>
<span>  n_intervals <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  design_ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  design_weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  design_strata <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  print_main_model <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  print_split_summary <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  add_smoother <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  title <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xlab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ylab <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  use_classic_theme <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  show_null_effect <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula-rhs">formula_rhs<a class="anchor" aria-label="anchor" href="#arg-formula-rhs"></a></dt>
<dd><p>A string specifying the right-hand side of the Cox model formula
(e.g., "treatment + age + sex").</p></dd>


<dt id="arg-design">design<a class="anchor" aria-label="anchor" href="#arg-design"></a></dt>
<dd><p>The original, un-split <code>svydesign</code> object.</p></dd>


<dt id="arg-var-to-test">var_to_test<a class="anchor" aria-label="anchor" href="#arg-var-to-test"></a></dt>
<dd><p>A string specifying the exact coefficient name to plot
(e.g., "age" or "treatmentYes").</p></dd>


<dt id="arg-time-var">time_var<a class="anchor" aria-label="anchor" href="#arg-time-var"></a></dt>
<dd><p>A string for the time-to-event variable name (default "stime").</p></dd>


<dt id="arg-status-var">status_var<a class="anchor" aria-label="anchor" href="#arg-status-var"></a></dt>
<dd><p>A string for the event status variable name (default "status", usually 0/1).</p></dd>


<dt id="arg-n-intervals">n_intervals<a class="anchor" aria-label="anchor" href="#arg-n-intervals"></a></dt>
<dd><p>Integer. The number of time intervals to create based on event
time quantiles (default is 5).</p></dd>


<dt id="arg-design-ids">design_ids<a class="anchor" aria-label="anchor" href="#arg-design-ids"></a></dt>
<dd><p>(Optional) A formula specifying the cluster IDs (e.g., <code>~psu</code>)
to be used if automatic extraction fails.</p></dd>


<dt id="arg-design-weights">design_weights<a class="anchor" aria-label="anchor" href="#arg-design-weights"></a></dt>
<dd><p>(Optional) A formula specifying the survey weights (e.g., <code>~weight</code>)
to be used if automatic extraction fails.</p></dd>


<dt id="arg-design-strata">design_strata<a class="anchor" aria-label="anchor" href="#arg-design-strata"></a></dt>
<dd><p>(Optional) A formula specifying the strata (e.g., <code>~strata</code>)
to be used if automatic extraction fails.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>Logical. If TRUE, prints debugging information about cut-points and convergence.</p></dd>


<dt id="arg-print-main-model">print_main_model<a class="anchor" aria-label="anchor" href="#arg-print-main-model"></a></dt>
<dd><p>Logical. If TRUE, prints a tidy summary of the main
(un-split) model.</p></dd>


<dt id="arg-print-split-summary">print_split_summary<a class="anchor" aria-label="anchor" href="#arg-print-split-summary"></a></dt>
<dd><p>Logical. If TRUE, prints a tidy summary table of
coefficients for every time interval.</p></dd>


<dt id="arg-add-smoother">add_smoother<a class="anchor" aria-label="anchor" href="#arg-add-smoother"></a></dt>
<dd><p>Logical. If TRUE, adds a loess smooth line to the plot.</p></dd>


<dt id="arg-title">title<a class="anchor" aria-label="anchor" href="#arg-title"></a></dt>
<dd><p>String. Custom title for the plot.</p></dd>


<dt id="arg-xlab">xlab<a class="anchor" aria-label="anchor" href="#arg-xlab"></a></dt>
<dd><p>String. Custom x-axis label.</p></dd>


<dt id="arg-ylab">ylab<a class="anchor" aria-label="anchor" href="#arg-ylab"></a></dt>
<dd><p>String. Custom y-axis label.</p></dd>


<dt id="arg-use-classic-theme">use_classic_theme<a class="anchor" aria-label="anchor" href="#arg-use-classic-theme"></a></dt>
<dd><p>Logical. If TRUE, uses <code><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic()</a></code>.</p></dd>


<dt id="arg-show-null-effect">show_null_effect<a class="anchor" aria-label="anchor" href="#arg-show-null-effect"></a></dt>
<dd><p>Logical. If TRUE, draws a dashed red line at y=0.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>ggplot</code> object showing the coefficient trend over time.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><strong>Methodology:</strong>
The function uses "Event-Based Splitting." Instead of splitting time into equal
chunks (e.g., every 5 years), it splits time based on quantiles of the event
times (e.g., 20th, 40th percentiles). This ensures that each interval contains
roughly the same number of events, maintaining statistical power across all
segments.</p>
<p><strong>Fix for Pipe/Subset Errors:</strong>
Survey design objects created via <code>magrittr</code> pipes or <code><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset()</a></code> often
cannot be easily reconstructed. This function attempts to automatically extract
the necessary design components (ids, weights, strata) and attach them to the data
before splitting. If this fails, the user can manually provide the
<code>design_ids</code>, <code>design_weights</code>, and <code>design_strata</code> arguments.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># --- 1. Load data and create a design ---</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://r-survey.r-forge.r-project.org/survey/" class="external-link">survey</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">nhanes_mortality</span>, package <span class="op">=</span> <span class="st">"svyTable1"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create a base design</span></span></span>
<span class="r-in"><span><span class="va">analytic_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="op">~</span><span class="va">strata</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="op">~</span><span class="va">psu</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="op">~</span><span class="va">survey_weight</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">nhanes_mortality</span>,</span></span>
<span class="r-in"><span>  nest <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Prepare data (filter to &gt;0 time)</span></span></span>
<span class="r-in"><span><span class="va">data_clean</span> <span class="op">&lt;-</span> <span class="va">analytic_design</span><span class="op">$</span><span class="va">variables</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">stime</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>caff_bin <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">caff</span> <span class="op">==</span> <span class="st">"No consumption"</span>, <span class="st">"No"</span>, <span class="st">"Yes"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create final design object</span></span></span>
<span class="r-in"><span><span class="va">final_design</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/survey/man/svydesign.html" class="external-link">svydesign</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  strata <span class="op">=</span> <span class="op">~</span><span class="va">strata</span>,</span></span>
<span class="r-in"><span>  id <span class="op">=</span> <span class="op">~</span><span class="va">psu</span>,</span></span>
<span class="r-in"><span>  weights <span class="op">=</span> <span class="op">~</span><span class="va">survey_weight</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">data_clean</span>,</span></span>
<span class="r-in"><span>  nest <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># --- Example 1: Standard Usage ---</span></span></span>
<span class="r-in"><span><span class="fu">svycoxph_CE</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula_rhs <span class="op">=</span> <span class="st">"caff_bin + age"</span>,</span></span>
<span class="r-in"><span>  design <span class="op">=</span> <span class="va">final_design</span>,</span></span>
<span class="r-in"><span>  var_to_test <span class="op">=</span> <span class="st">"age"</span>,</span></span>
<span class="r-in"><span>  time_var <span class="op">=</span> <span class="st">"stime"</span>,</span></span>
<span class="r-in"><span>  status_var <span class="op">=</span> <span class="st">"status"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># --- Example 2: Manual Safety Valve (if automatic extraction fails) ---</span></span></span>
<span class="r-in"><span><span class="fu">svycoxph_CE</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula_rhs <span class="op">=</span> <span class="st">"caff_bin + age"</span>,</span></span>
<span class="r-in"><span>  design <span class="op">=</span> <span class="va">final_design</span>,</span></span>
<span class="r-in"><span>  var_to_test <span class="op">=</span> <span class="st">"caff_binYes"</span>, <span class="co"># Note: Check exact coef name</span></span></span>
<span class="r-in"><span>  design_ids <span class="op">=</span> <span class="op">~</span><span class="va">psu</span>,</span></span>
<span class="r-in"><span>  design_weights <span class="op">=</span> <span class="op">~</span><span class="va">survey_weight</span>,</span></span>
<span class="r-in"><span>  design_strata <span class="op">=</span> <span class="op">~</span><span class="va">strata</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Ehsan Karim.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

