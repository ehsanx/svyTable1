% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/svycoxph_CE.R
\name{svycoxph_CE}
\alias{svycoxph_CE}
\title{Plot Time-Varying Coefficients for a svycoxph Model}
\usage{
svycoxph_CE(
  formula_rhs,
  design,
  var_to_test,
  time_var = "stime",
  status_var = "status",
  n_intervals = 5,
  verbose = FALSE,
  print_main_model = TRUE,
  print_split_summary = TRUE,
  add_smoother = FALSE,
  title = NULL,
  xlab = NULL,
  ylab = NULL,
  use_classic_theme = TRUE,
  show_null_effect = FALSE
)
}
\arguments{
\item{formula_rhs}{A string for the right-hand side of your Cox model.}

\item{design}{The original, un-split svydesign object.}

\item{var_to_test}{A string specifying the exact coefficient name to plot.}

\item{time_var}{A string for the follow-up time variable.}

\item{status_var}{A string for the event status variable (must be 0/1).}

\item{n_intervals}{The number of time intervals to create (default is 5).}

\item{verbose}{A logical. If TRUE, prints extra debugging information.}

\item{print_main_model}{A logical. If TRUE, prints a tidy summary of the
main (un-split) proportional hazards model.}

\item{print_split_summary}{A logical. If TRUE, prints a tidy summary table
of all coefficients from all interval models.}

\item{add_smoother}{A logical. If TRUE, adds a loess smooth line to the plot.}

\item{title}{A string. Custom title for the plot.}

\item{xlab}{A string. Custom x-axis label.}

\item{ylab}{A string. Custom y-axis label.}

\item{use_classic_theme}{A logical. If TRUE, uses theme_classic() (white bg,
no grid). If FALSE, uses theme_minimal().}

\item{show_null_effect}{A logical. If TRUE (default), draws the red dashed
line at y=0.}
}
\value{
A ggplot object.
}
\description{
This function provides a valid alternative to cox.zph() for complex survey
designs by fitting separate models to different time intervals and
plotting the resulting coefficients to check the Constant Effect
(Proportional Hazards) assumption.
}
\examples{
\dontrun{
# --- 1. Load data from svyTable1 and create base design ---
require(svyTable1)
data(nhanes_mortality)
analytic_design <- svydesign(
  strata = ~strata,
  id = ~psu,
  weights = ~survey_weight,
  data = nhanes_mortality,
  nest = TRUE
)

# --- 2. Create the analysis data.frame with all variables ---
# We filter and create 'caff_bin' in this data.frame
data_full_clean <- analytic_design$variables \%>\%
  dplyr::filter(stime > 0) \%>\%
  mutate(
    caff_bin = factor(
      ifelse(caff == "No consumption", "No", "Yes"),
      levels = c("No", "Yes")
    )
  )

# --- 3. Create the FINAL analytic design object ---
# This new design object *contains* caff_bin, sex, and age
analytic_design_final <- svydesign(
  strata = ~strata,
  id = ~psu,
  weights = ~survey_weight,
  data = data_full_clean,
  nest = TRUE
)

# --- 4. Define the model and variable to test ---
my_formula <- "caff_bin + age"
my_var <- "age"

# --- 5. Run the function ---
svycoxph_CE(
  formula_rhs = my_formula,
  design = analytic_design_final,
  var_to_test = my_var,
  time_var = "stime",
  status_var = "status",
  n_intervals = 5,
  verbose = TRUE,
  print_main_model = TRUE,
  print_split_summary = TRUE
)
}
}
